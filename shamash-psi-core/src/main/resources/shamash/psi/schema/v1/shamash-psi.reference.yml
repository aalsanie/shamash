# Shamash PSI Reference Configuration (Schema v1)
#
# PSI engine: source analysis inside the IDE (inspections + quick feedback).
# This reference aims to be:
# - non-opinionated
# - plug-and-play (works without knowing the repo's root package)
# - useful immediately (unused private members, god classes by role, layering violations)
#
# NOTE: edit based on your team needs and architecture, view ./docs for customization references

version: 1

project:
  # Root package is optional.
  # If you set mode: EXPLICIT and value: "com.yourcompany", you can enable packages.rootPackage.
  rootPackage:
    mode: AUTO
    value: ""

  # Include/exclude globs are applied relative to the project root.
  # Empty include means "scan everything", then exclusions trim noise.
  sourceGlobs:
    include: []
    exclude:
      # build outputs
      - "**/build/**"
      - "**/target/**"
      - "**/out/**"
      - "**/bin/**"
      - "**/.gradle/**"
      - "**/.m2/**"
      # typical generated locations
      - "**/generated/**"
      - "**/node_modules/**"

  validation:
    unknownRule: ERROR

# Role detection (heuristics).
# PSI matchers are richer (classNameEndsWithAny, implements/extends, hasMainMethod, etc.).
roles:
  controller:
    description: "Inbound edge of the system: HTTP / RPC / entrypoint handlers"
    priority: 90
    match:
      anyOf:
        - annotationPrefix: "org.springframework.web.bind.annotation."
        - annotation: "javax.ws.rs.Path"
        - annotationPrefix: "jakarta.ws.rs."
        - packageContainsSegment: "controller"
        - packageContainsSegment: "controllers"
        - packageContainsSegment: "api"
        - packageContainsSegment: "web"
        - packageContainsSegment: "rest"
        - classNameEndsWithAny:
            - "Controller"
            - "Resource"
            - "Endpoint"
            - "Handler"

  service:
    description: "Business logic / use-cases"
    priority: 80
    match:
      anyOf:
        - annotation: "org.springframework.stereotype.Service"
        - annotationPrefix: "jakarta.inject."
        - annotationPrefix: "javax.inject."
        - packageContainsSegment: "service"
        - packageContainsSegment: "services"
        - packageContainsSegment: "usecase"
        - packageContainsSegment: "usecases"
        - packageContainsSegment: "application"
        - classNameEndsWithAny:
            - "Service"
            - "UseCase"
            - "Interactor"

  repository:
    description: "Persistence boundary (DB / storage adapters)"
    priority: 70
    match:
      anyOf:
        - annotation: "org.springframework.stereotype.Repository"
        - packageContainsSegment: "repository"
        - packageContainsSegment: "repositories"
        - packageContainsSegment: "dao"
        - packageContainsSegment: "persistence"
        - classNameEndsWithAny:
            - "Repository"
            - "Dao"
            - "DAO"

  domain:
    description: "Domain model / DTOs / entities"
    priority: 50
    match:
      anyOf:
        - packageContainsSegment: "domain"
        - packageContainsSegment: "model"
        - packageContainsSegment: "models"
        - packageContainsSegment: "entity"
        - packageContainsSegment: "entities"
        - packageContainsSegment: "dto"
        - classNameEndsWith: "Dto"

  config:
    description: "Configuration / wiring"
    priority: 40
    match:
      anyOf:
        - packageContainsSegment: "config"
        - packageContainsSegment: "configuration"
        - classNameEndsWithAny:
            - "Config"
            - "Configuration"

  util:
    description: "Shared utilities / helpers"
    priority: 10
    match:
      anyOf:
        - packageContainsSegment: "util"
        - packageContainsSegment: "utils"
        - packageContainsSegment: "common"
        - packageContainsSegment: "shared"
        - classNameEndsWithAny:
            - "Util"
            - "Utils"
            - "Helper"

rules:
  # ---- deadcode ----

  - type: deadcode
    name: unusedPrivateMembers
    enabled: true
    severity: WARNING
    params:
      check:
        fields: true
        methods: true
        classes: false
      # Keep defaults broad. Users can add ignores for generated/annotated members if needed.

  # ---- metrics ----

  - type: metrics
    name: maxMethodsByRole
    enabled: true
    severity: WARNING
    params:
      # Role-based method limits help reveal "god classes" without hardcoding package names.
      limits:
        controller: 25
        service: 35
        repository: 25
        domain: 40
        config: 25
        util: 40
      countKinds:
        - declaredMethods
      # You can ignore boilerplate by regex if needed (getters/setters/builders/etc.).
      ignoreMethodNameRegex: []

  # ---- architecture ----

  - type: arch
    name: forbiddenRoleDependencies
    enabled: true
    severity: ERROR
    params:
      # This focuses on the highest-signal layering problem that generalizes well.
      forbidden:
        - from: controller
          to:
            - repository
          message: "Controllers/entrypoints should depend on services, not directly on persistence."

  # ---- packages ----

  - type: packages
    name: rolePlacement
    enabled: true
    severity: WARNING
    params:
      # Broad, framework-agnostic package expectations per role.
      # Only applies when a role is detected for a class.
      expected:
        controller:
          packageRegex: ".*\\.(controller|controllers|api|web|rest|endpoint)(\\..*)?$"
        service:
          packageRegex: ".*\\.(service|services|usecase|usecases|application)(\\..*)?$"
        repository:
          packageRegex: ".*\\.(repository|repositories|dao|persistence)(\\..*)?$"
        domain:
          packageRegex: ".*\\.(domain|model|models|entity|entities|dto)(\\..*)?$"
        config:
          packageRegex: ".*\\.(config|configuration)(\\..*)?$"
        util:
          packageRegex: ".*\\.(util|utils|common|shared)(\\..*)?$"

  # ---- naming ----

  - type: naming
    name: bannedSuffixes
    enabled: true
    severity: INFO
    params:
      # Small, low-noise default: "Impl" in public types often leaks internal structure.
      banned:
        - "Impl"
      # If you want, limit this to specific roles:
      # applyToRoles: [service, repository]
      caseSensitive: true

  # ---- packages.rootPackage ----

  - type: packages
    name: rootPackage
    enabled: false
    severity: WARNING
    params:
      # Enable this after setting project.rootPackage.mode=EXPLICIT and providing a value.
      # When enabled, it flags source files that live outside the declared root package.
      mode: EXPLICIT
      value: "com.example"

exceptions: []
