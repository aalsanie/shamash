<idea-plugin>
    <id>io.shamash</id>
    <name>Shamash</name>

    <vendor email="a.aalsanie@outlook.com">A.Alsanie</vendor>

    <description><![CDATA[
        Shamash is a JVM architecture enforcement tool that helps teams define, validate, and continuously enforce architectural boundaries.
        <br/><br/>
        It ships two complementary engines:
        <br/><br/>
        <b>ASM</b>:
        analyzes compiled bytecode and jars to detect architectural drift, dependency violations, and forbidden couplings.
        <br/><br/>
        <b>PSI</b>:
        analyzes source code via IntelliJ PSI using a configurable YAML schema, provides architectural dashboards, inline suppressions, guided fixes, and exportable reports.
    ]]></description>

    <depends>com.intellij.modules.java</depends>
    <depends optional="true" config-file="META-INF/shamash-kotlin.xml">org.jetbrains.kotlin</depends>

    <extensions defaultExtensionNs="com.intellij">

        <!-- Notifications -->
        <notificationGroup id="Shamash PSI"
                           displayType="BALLOON"
                           isLogByDefault="true"/>

        <notificationGroup id="Shamash ASM"
                           displayType="BALLOON"
                           isLogByDefault="true"/>

        <!-- Tool Windows -->
        <toolWindow id="Shamash PSI"
                    anchor="right"
                    icon="/icons/pluginIcon.svg"
                    factoryClass="io.shamash.intellij.plugin.psi.ui.ShamashPsiToolWindowFactory"/>

        <toolWindow id="Shamash ASM"
                    anchor="right"
                    icon="/icons/pluginIcon.svg"
                    factoryClass="io.shamash.intellij.plugin.asm.ui.ShamashAsmToolWindowFactory"/>

        <!-- Settings / Services -->
        <applicationService serviceImplementation="io.shamash.intellij.plugin.settings.ShamashSettings"/>

    </extensions>

    <actions>

        <!-- ============== PSI ============== -->

        <action id="io.shamash.intellij.plugin.psi.ui.actions.OpenPsiDashboardAction"
                class="io.shamash.intellij.plugin.psi.ui.actions.OpenPsiDashboardAction"
                text="Shamash: PSI Dashboard"
                description="Open the Shamash PSI dashboard."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.intellij.plugin.psi.ui.actions.RunPsiScanAction"
                class="io.shamash.intellij.plugin.psi.ui.actions.RunPsiScanAction"
                text="Shamash: Run PSI Scan"
                description="Runs Shamash PSI rules on project source using IntelliJ PSI."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.intellij.plugin.psi.ui.actions.ValidatePsiConfigAction"
                class="io.shamash.intellij.plugin.psi.ui.actions.ValidatePsiConfigAction"
                text="Shamash: Validate PSI Config"
                description="Validates Shamash PSI YAML against schema and semantic rules."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.intellij.plugin.psi.ui.actions.CreatePsiConfigFromReferenceAction"
                class="io.shamash.intellij.plugin.psi.ui.actions.CreatePsiConfigFromReferenceAction"
                text="Shamash: Create PSI Config (from Reference)"
                description="Creates a PSI config file in the current project from the built-in reference YAML."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.intellij.plugin.psi.ui.actions.OpenPsiReferenceConfigAction"
                class="io.shamash.intellij.plugin.psi.ui.actions.OpenPsiReferenceConfigAction"
                text="Shamash: Open PSI Reference Config"
                description="Open the built-in Shamash PSI reference YAML."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.intellij.plugin.psi.ui.actions.ExportPsiReportsAction"
                class="io.shamash.intellij.plugin.psi.ui.actions.ExportPsiReportsAction"
                text="Shamash: Export PSI Reports"
                description="Exports Shamash PSI findings to JSON/SARIF/XML/HTML under the project export directory."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>


        <!-- ============== ASM ============== -->

        <action id="io.shamash.asm.openDashboard"
                class="io.shamash.intellij.plugin.asm.ui.actions.OpenAsmDashboardAction"
                text="Shamash: ASM Dashboard"
                description="Open the Shamash ASM dashboard."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.asm.runScan"
                class="io.shamash.intellij.plugin.asm.ui.actions.RunAsmScanAction"
                text="Run ASM Scan"
                description="Runs Shamash ASM rules on compiled bytecode and jars."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.asm.validateConfig"
                class="io.shamash.intellij.plugin.asm.ui.actions.ValidateAsmConfigAction"
                text="Validate ASM Config"
                description="Validates Shamash ASM YAML against schema and semantic rules."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.asm.createConfigFromReference"
                class="io.shamash.intellij.plugin.asm.ui.actions.CreateAsmConfigFromReferenceAction"
                text="Create ASM Config (from Reference)"
                description="Creates an ASM config file in the current project from the built-in reference YAML."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.asm.openReferenceConfig"
                class="io.shamash.intellij.plugin.asm.ui.actions.OpenAsmReferenceConfigAction"
                text="Open ASM Reference Config"
                description="Open the built-in Shamash ASM reference YAML."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.asm.exportReports"
                class="io.shamash.intellij.plugin.asm.ui.actions.ExportAsmReportsAction"
                text="Export ASM Reports"
                description="Exports Shamash ASM findings to JSON/SARIF/XML/HTML under the project export directory."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

    </actions>

    <change-notes><![CDATA[
  <ul>
    <li><strong>Added</strong>: ASM <strong>Facts</strong> tab (lazy-loading) to browse dependency facts without keeping the full graph in memory</li>
    <li><strong>Added</strong>: Facts export artifact (<code>facts.jsonl.gz</code> / <code>facts.json</code>) and <code>factsPath</code> in export results</li>
    <li><strong>Added</strong>: CLI facts support (<code>scan --export-facts</code> and new <code>facts</code> subcommand for summaries + filters)</li>
    <li><strong>Added</strong>: Advanced option <code>includeFactsInMemory</code> to include facts in scan result when needed</li>

    <li><strong>Fixed</strong>: Simplified UI and added clearer in-panel instructions</li>
    <li><strong>Fixed</strong>: Dashboard panel action buttons overlap</li>
    <li><strong>Fixed</strong>: Config panel action buttons overlap</li>
    <li><strong>Fixed</strong>: ASM Config tab summary messaging now reflects validation/scan state accurately</li>
    <li><strong>Fixed</strong>: Validate Config now redirects to Dashboard only on successful validation</li>
    <li><strong>Fixed</strong>: Open Reference YAML now opens reliably (UTF-8 + content normalization for virtual file)</li>

    <li><strong>Removed</strong>: Removed redundant UI labels</li>
  </ul>
]]></change-notes>


</idea-plugin>
