<idea-plugin>
    <id>io.shamash</id>
    <name>Shamash</name>

    <vendor email="a.aalsanie@outlook.com">A.Alsanie</vendor>

    <description><![CDATA[
        Shamash is a JVM architecture enforcement tool that helps teams define, validate, and continuously enforce architectural boundaries.
        <br/><br/>
        It ships two complementary engines:
        <br/><br/>
        <b>ASM</b>:
        analyzes compiled bytecode and jars to detect architectural drift, dependency violations, hotspots, graphs, scoring and forbidden couplings.
        <br/><br/>
        <b>PSI</b>:
        analyzes source code via IntelliJ PSI using a configurable YAML schema, provides architectural dashboards, inline suppressions, guided fixes, and exportable reports.
    ]]></description>

    <depends>com.intellij.modules.java</depends>
    <depends optional="true" config-file="META-INF/shamash-kotlin.xml">org.jetbrains.kotlin</depends>

    <extensionPoints>
        <extensionPoint qualifiedName="io.shamash.asmRuleRegistryProvider"
                        interface="io.shamash.asm.core.engine.rules.spi.AsmRuleRegistryProvider"
                        dynamic="true"/>
    </extensionPoints>

    <extensions defaultExtensionNs="com.intellij">

        <!-- Notifications -->
        <notificationGroup id="Shamash PSI"
                           displayType="BALLOON"
                           isLogByDefault="true"/>

        <notificationGroup id="Shamash ASM"
                           displayType="BALLOON"
                           isLogByDefault="true"/>

        <!-- Tool Windows -->
        <toolWindow id="Shamash PSI"
                    anchor="right"
                    icon="/icons/pluginIcon.svg"
                    factoryClass="io.shamash.intellij.plugin.psi.ui.ShamashPsiToolWindowFactory"/>

        <toolWindow id="Shamash ASM"
                    anchor="right"
                    icon="/icons/pluginIcon.svg"
                    factoryClass="io.shamash.intellij.plugin.asm.ui.ShamashAsmToolWindowFactory"/>

        <!-- Settings / Services -->
        <applicationService serviceImplementation="io.shamash.intellij.plugin.settings.ShamashSettings"/>

    </extensions>

    <actions>

        <!-- ============== PSI ============== -->

        <action id="io.shamash.intellij.plugin.psi.ui.actions.OpenPsiDashboardAction"
                class="io.shamash.intellij.plugin.psi.ui.actions.OpenPsiDashboardAction"
                text="Shamash: PSI Dashboard"
                description="Open the Shamash PSI dashboard."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.intellij.plugin.psi.ui.actions.RunPsiScanAction"
                class="io.shamash.intellij.plugin.psi.ui.actions.RunPsiScanAction"
                text="Shamash: Run PSI Scan"
                description="Runs Shamash PSI rules on project source using IntelliJ PSI."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.intellij.plugin.psi.ui.actions.ValidatePsiConfigAction"
                class="io.shamash.intellij.plugin.psi.ui.actions.ValidatePsiConfigAction"
                text="Shamash: Validate PSI Config"
                description="Validates Shamash PSI YAML against schema and semantic rules."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.intellij.plugin.psi.ui.actions.CreatePsiConfigFromReferenceAction"
                class="io.shamash.intellij.plugin.psi.ui.actions.CreatePsiConfigFromReferenceAction"
                text="Shamash: Create PSI Config (from Reference)"
                description="Creates a PSI config file in the current project from the built-in reference YAML."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.intellij.plugin.psi.ui.actions.OpenPsiReferenceConfigAction"
                class="io.shamash.intellij.plugin.psi.ui.actions.OpenPsiReferenceConfigAction"
                text="Shamash: Open PSI Reference Config"
                description="Open the built-in Shamash PSI reference YAML."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.intellij.plugin.psi.ui.actions.ExportPsiReportsAction"
                class="io.shamash.intellij.plugin.psi.ui.actions.ExportPsiReportsAction"
                text="Shamash: Export PSI Reports"
                description="Exports Shamash PSI findings to JSON/SARIF/XML/HTML under the project export directory."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>


        <!-- ============== ASM ============== -->

        <action id="io.shamash.asm.openDashboard"
                class="io.shamash.intellij.plugin.asm.ui.actions.OpenAsmDashboardAction"
                text="Shamash: ASM Dashboard"
                description="Open the Shamash ASM dashboard."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.asm.runScan"
                class="io.shamash.intellij.plugin.asm.ui.actions.RunAsmScanAction"
                text="Run ASM Scan"
                description="Runs Shamash ASM rules on compiled bytecode and jars."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.asm.validateConfig"
                class="io.shamash.intellij.plugin.asm.ui.actions.ValidateAsmConfigAction"
                text="Validate ASM Config"
                description="Validates Shamash ASM YAML against schema and semantic rules."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.asm.createConfigFromReference"
                class="io.shamash.intellij.plugin.asm.ui.actions.CreateAsmConfigFromReferenceAction"
                text="Create ASM Config (from Reference)"
                description="Creates an ASM config file in the current project from the built-in reference YAML."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.asm.openReferenceConfig"
                class="io.shamash.intellij.plugin.asm.ui.actions.OpenAsmReferenceConfigAction"
                text="Open ASM Reference Config"
                description="Open the built-in Shamash ASM reference YAML."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.asm.exportReports"
                class="io.shamash.intellij.plugin.asm.ui.actions.ExportAsmReportsAction"
                text="Export ASM Reports"
                description="Exports Shamash ASM findings to JSON/SARIF/XML/HTML under the project export directory."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

    </actions>

    <change-notes><![CDATA[
  <ul>
    <li><strong>Added</strong>: Scan override “knobs” in CLI/IntelliJ so users can tune scans without editing YAML, and the UI shows which overrides were applied</li>
    <li><strong>Added</strong>: Registry provider selection in both CLI and IntelliJ</li>
    <li><strong>Added</strong>: Roles debugging is now exportable and visible:
      <ul>
        <li>ASM export writes <code>roles.json</code> when <code>export.artifacts.roles.enabled: true</code></li>
        <li>New UI <strong>Roles</strong> tab with role search + class search</li>
      </ul>
    </li>
    <li><strong>Added</strong>: ASM analysis outputs:
      <ul>
        <li>In-memory graphs + hotspots + scoring computed during scan</li>
        <li>Analysis sidecar artifacts (graphs/hotspots/scoring) when export is enabled</li>
        <li>New <strong>Analysis</strong> tab (Graphs / Hotspots / Scoring)</li>
      </ul>
    </li>
  </ul>
]]></change-notes>


</idea-plugin>
