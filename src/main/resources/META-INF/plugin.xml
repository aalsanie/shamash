<idea-plugin>
    <id>io.shamash</id>
    <name>Shamash</name>

    <vendor email="a.aalsanie@outlook.com">Ahmad Alsanie</vendor>

    <description><![CDATA[
        Shamash is a JVM architecture enforcement tool with two complementary engines:
        <br/><br/>
        <b>ASM</b>:
        analyzes compiled bytecode and jars to detect architectural drift, dependency violations, and forbidden couplings â€” without requiring source code.
        <br/><br/>
        <b>PSI</b>:
        analyzes source code via IntelliJ PSI using a configurable YAML schema, provides architectural dashboards, inline suppressions, guided fixes, and exportable reports.
    ]]></description>

    <depends>com.intellij.modules.java</depends>
    <depends optional="true" config-file="shamash-kotlin.xml">org.jetbrains.kotlin</depends>

    <extensions defaultExtensionNs="com.intellij">

        <!-- Notifications -->
        <notificationGroup id="Shamash PSI"
                           displayType="BALLOON"
                           isLogByDefault="true"/>

        <!-- Tool Windows -->
        <toolWindow id="Shamash ASM"
                    anchor="right"
                    icon="/icons/pluginIcon.svg"
                    factoryClass="io.shamash.asm.ui.AsmDashboardToolWindowsFactory"/>

        <toolWindow id="Shamash PSI"
                    anchor="right"
                    icon="/icons/pluginIcon.svg"
                    factoryClass="io.shamash.psi.ui.ShamashPsiToolWindowFactory"/>

        <!-- Settings / Services -->
        <applicationService serviceImplementation="io.shamash.settings.ShamashSettings"/>

        <!-- If you add dedicated PSI settings later, register them explicitly:
        <projectService serviceImplementation="io.shamash.psi.ui.ShamashPsiToolWindowController"/>
        -->

    </extensions>

    <actions>

        <!-- ============== ASM ============== -->

        <action id="io.shamash.asm.actions.RunAsmScanAction"
                class="io.shamash.asm.actions.RunAsmScanAction"
                text="Shamash: Run ASM Scan"
                description="Scans module outputs and dependency jars to build a bytecode index."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.asm.actions.OpenAsmDashboardAction"
                class="io.shamash.asm.actions.OpenDashboardAction"
                text="Shamash: ASM Dashboard"
                description="Open the Shamash ASM dashboard."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <!-- ============== PSI ============== -->

        <action id="io.shamash.psi.actions.OpenPsiDashboardAction"
                class="io.shamash.psi.ui.actions.OpenPsiDashboardAction"
                text="Shamash: PSI Dashboard"
                description="Open the Shamash PSI dashboard."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.psi.actions.RunPsiScanAction"
                class="io.shamash.psi.ui.actions.RunPsiScanAction"
                text="Shamash: Run PSI Scan"
                description="Runs Shamash PSI rules on project source using IntelliJ PSI."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.psi.actions.ValidatePsiConfigAction"
                class="io.shamash.psi.ui.actions.ValidatePsiConfigAction"
                text="Shamash: Validate PSI Config"
                description="Validates Shamash PSI YAML against schema and semantic rules."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.psi.actions.CreatePsiConfigFromReferenceAction"
                class="io.shamash.psi.ui.actions.CreatePsiConfigFromReferenceAction"
                text="Shamash: Create PSI Config (from Reference)"
                description="Creates a PSI config file in the current project from the built-in reference YAML."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.psi.actions.OpenPsiReferenceConfigAction"
                class="io.shamash.psi.ui.actions.OpenPsiReferenceConfigAction"
                text="Shamash: Open PSI Reference Config"
                description="Open the built-in Shamash PSI reference YAML."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action id="io.shamash.psi.actions.ExportPsiReportsAction"
                class="io.shamash.psi.ui.actions.ExportPsiReportsAction"
                text="Shamash: Export PSI Reports"
                description="Exports Shamash PSI findings to JSON/SARIF/XML/HTML under the project export directory."
                icon="/icons/pluginIcon.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

    </actions>

    <change-notes><![CDATA[
                     <ul>
                      <li><strong>PSI Config v1</strong>: schema + validation stabilized (clear errors, consistent param typing)</li>
                      <li><strong>Scan pipeline refactor</strong>: safer indexing/read-action handling + progress feedback</li>
                      <li><strong>Baseline / export / fixes</strong>: updated to align with the v1 config pipeline</li>
                      <li><strong>Reference config</strong>: updated with examples for quick verification</li>
                      <li><strong>Known gap</strong>: automated tests in progress (unit + integration + E2E)</li>
                    </ul>
                     ]]>
    </change-notes>
</idea-plugin>
