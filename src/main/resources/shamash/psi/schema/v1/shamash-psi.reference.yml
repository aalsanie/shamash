version: 1

project:
  validation:
    unknownRuleId: warn
  sourceGlobs:
    include:
      - "src/main/java/**"
      - "src/main/kotlin/**"
    exclude:
      - "**/build/**"
      - "**/.gradle/**"
      - "**/out/**"
      - "**/.idea/**"
      - "**/generated/**"

roles:
  controller:
    priority: 100
    match:
      anyOf:
        - annotation: "org.springframework.web.bind.annotation.RestController"
        - annotation: "org.springframework.stereotype.Controller"
        - packageRegex: ".*\\.controller(\\..*)?$"
        - classNameEndsWith: "Controller"

  service:
    priority: 80
    match:
      anyOf:
        - annotation: "org.springframework.stereotype.Service"
        - packageRegex: ".*\\.service(\\..*)?$"
        - classNameEndsWith: "Service"

  repository:
    priority: 60
    match:
      anyOf:
        - annotation: "org.springframework.stereotype.Repository"
        - packageRegex: ".*\\.(dao|repository)(\\..*)?$"
        - classNameEndsWithAny: ["Dao", "Repository"]

rules:

  naming.bannedSuffixes:
    enabled: true
    severity: WARNING
    banned: ["Action"]          # matches ExportPsiReportsAction, RunPsiScanAction, etc.
    applyTo: "classes"
    caseSensitive: true

  arch.forbiddenRoleDependencies:
    enabled: true
    severity: ERROR
    kinds: ["methodCall","fieldType","parameterType","returnType","extends","implements","annotationType"]
    forbidden:
      - from: "controller"
        to: ["repository"]
      - from: "service"
        to: ["controller"]

  metrics.maxMethodsByRole.controller:
    enabled: true
    severity: WARNING
    role: "controller"
    max: 5

  metrics.maxMethodsByRole.service:
    enabled: true
    severity: WARNING
    role: "service"
    max: 8

  metrics.maxMethodsByRole.repository:
    enabled: true
    severity: WARNING
    role: "repository"
    max: 10

  packages.rolePlacement:
    enabled: true
    severity: WARNING
    mode: "any"
    placement:
      controller:
        - ".*\\.controller(\\..*)?$"
      service:
        - ".*\\.service(\\..*)?$"
      repository:
        - ".*\\.(dao|repository)(\\..*)?$"

  deadcode.unusedPrivateMembers:
    enabled: true
    severity: INFO
    check:
      fields: true
      methods: true
      classes: false
    ignoreIfAnnotatedWithPrefix:
      - "org.junit."
      - "org.springframework.web.bind.annotation."
      - "jakarta.persistence."
      - "com.fasterxml.jackson.annotation."
      - "lombok."
